---
import { getCollection } from "astro:content";
import { make as BannerReact } from "./BannerReact.res.mjs";
import { shouldShowBanner } from "../utils/bannerUtils.res.mjs";
import HolidayMinis from "../assets/HolidayMinis.jpg";
import HolidayMinisMobile from "../assets/HolidayMinisMobile.jpg";
import HolidayMinisUltraWide from "../assets/HolidayMinisUltraWide.jpg";
import { HOLIDAY_MINIS_LINK } from "../data/links";
import ExternalLink from "./ExternalLink.astro";

let messages = await getCollection("bannerMessages");

// Server-side date checking to determine which banner to show
let activeBanner = messages.find(({ data: { startDate, endDate } }) =>
  shouldShowBanner(startDate, endDate),
);

const shouldShow = activeBanner !== undefined;
const templateId = activeBanner?.data.templateId;
---

{
  shouldShow && templateId === "holiday-minis" ? (
    <BannerReact client:load shouldShow={shouldShow}>
      <ExternalLink
        href={HOLIDAY_MINIS_LINK}
        class="flex w-screen items-center justify-center bg-gradient-to-r from-[#52947a] to-[#52957a]"
      >
        <picture class="flex w-screen items-center justify-center">
          <source
            srcset={HolidayMinisMobile.src}
            media="(max-width: 767px)"
            type="image/webp"
          />
          <source
            srcset={HolidayMinis.src}
            media="(min-width: 768px) and (max-width: 1099px)"
            type="image/webp"
          />
          <source
            srcset={HolidayMinisUltraWide.src}
            media="(min-width: 1100px)"
            type="image/webp"
          />
          <img
            src={HolidayMinis.src}
            alt="Holiday Minis Banner"
            class="w-screen max-w-[2560px]"
            loading="lazy"
            decoding="async"
          />
        </picture>
      </ExternalLink>
    </BannerReact>
  ) : (
    <BannerReact client:load shouldShow={false} />
  )
}
